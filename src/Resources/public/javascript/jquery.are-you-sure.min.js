/*! Copyright (c) 2012-2014, Chris Dance and PaperCut Software http://www.papercut.com/ Dual licensed under the MIT or GPL Version 2 licenses. */
(function(e){e.fn.areYouSure=function(t){var n=e.extend({message:"You have unsaved changes!",dirtyClass:"dirty",change:null,silent:false,addRemoveFieldsMarksDirty:false,fieldEvents:"change keyup propertychange input",fieldSelector:":input:not(input[type=submit]):not(input[type=button])"},t);var r=function(t){if(t.hasClass("ays-ignore")||t.hasClass("aysIgnore")||t.attr("data-ays-ignore")||t.attr("name")===undefined){return null}if(t.is(":disabled")){return"ays-disabled"}var n;var r=t.attr("type");if(t.is("select")){r="select"}switch(r){case"checkbox":case"radio":n=t.is(":checked");break;case"select":n="";t.find("option").each(function(t){var r=e(this);if(r.is(":selected")){n+=r.val()}});break;default:n=t.val()}return n};var i=function(e){e.data("ays-orig",r(e))};var s=function(t){var i=function(e){var t=e.data("ays-orig");if(undefined===t){return false}return r(e)!=t};var s=e(this).is("form")?e(this):e(this).parents("form");if(i(e(t.target))){u(s,true);return}$fields=s.find(n.fieldSelector);if(n.addRemoveFieldsMarksDirty){var o=s.data("ays-orig-field-count");if(o!=$fields.length){u(s,true);return}}var a=false;$fields.each(function(){$field=e(this);if(i($field)){a=true;return false}});u(s,a)};var o=function(t){var r=t.find(n.fieldSelector);e(r).each(function(){i(e(this))});e(r).unbind(n.fieldEvents,s);e(r).bind(n.fieldEvents,s);t.data("ays-orig-field-count",e(r).length);u(t,false)};var u=function(e,t){var r=t!=e.hasClass(n.dirtyClass);e.toggleClass(n.dirtyClass,t);if(r){if(n.change)n.change.call(e,e);if(t)e.trigger("dirty.areYouSure",[e]);if(!t)e.trigger("clean.areYouSure",[e]);e.trigger("change.areYouSure",[e])}};var a=function(){var t=e(this);var r=t.find(n.fieldSelector);e(r).each(function(){var t=e(this);if(!t.data("ays-orig")){i(t);t.bind(n.fieldEvents,s)}});t.trigger("checkform.areYouSure")};var f=function(){o(e(this))};if(!n.silent&&!window.aysUnloadSet){window.aysUnloadSet=true;e(window).bind("beforeunload",function(){$dirtyForms=e("form").filter("."+n.dirtyClass);if($dirtyForms.length==0){return}if(navigator.userAgent.toLowerCase().match(/msie|chrome/)){if(window.aysHasPrompted){return}window.aysHasPrompted=true;window.setTimeout(function(){window.aysHasPrompted=false},900)}return n.message})}return this.each(function(t){if(!e(this).is("form")){return}var r=e(this);r.submit(function(){r.removeClass(n.dirtyClass)});r.bind("reset",function(){u(r,false)});r.bind("rescan.areYouSure",a);r.bind("reinitialize.areYouSure",f);r.bind("checkform.areYouSure",s);o(r)})}})(jQuery)
